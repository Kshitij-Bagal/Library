import{r as d,a as P,b as y,j as e,c as C}from"./index-ChPI-T4s.js";const A=()=>{const[r,i]=d.useState({title:"",author:"",description:"",price:"",publishDate:"",genre:"",pdf:null,image:null}),[p,x]=d.useState("No PDF chosen"),[c,j]=d.useState("No Image chosen"),[f,b]=d.useState(0),[h,v]=d.useState(null),N=P(),D=y();d.useEffect(()=>{fetch("https://library-backend-vi4b.onrender.com/api/books").then(t=>t.json()).then(t=>b(t.length)).catch(t=>console.error("Error fetching book count:",t))},[]);const u=(t,a)=>{const n=t.target.files[0];if(i(o=>({...o,[a]:n})),a==="pdf"&&x(n?n.name:"No PDF chosen"),a==="image"&&(j(n?n.name:"No Image chosen"),n)){const o=new FileReader;o.onloadend=()=>v(o.result),o.readAsDataURL(n)}},k=async t=>{var o,g;if(t.preventDefault(),!r.title||!r.author||!r.description||!r.pdf||!r.image){alert("Please fill all fields and upload both the PDF and cover image.");return}const a=new FormData,n=f+1;a.append("id",n),a.append("name",r.title),a.append("price",r.price||"$100"),a.append("author",r.author),a.append("description",r.description),a.append("genre",r.genre||"N/A"),a.append("publishDate",r.publishDate||"N/A"),a.append("pdf",r.pdf),a.append("image",r.image);try{const l=await fetch("https://library-backend-vi4b.onrender.com/upload",{method:"POST",body:a});if(!l.ok)throw new Error(`Upload failed: ${l.status} ${l.statusText}`);const m=await l.text();console.log("Raw server response:",m);let s;try{s=JSON.parse(m)}catch(w){console.error("Error parsing JSON:",w),alert("Invalid response from the server.");return}s!=null&&s.success&&((o=s.metadata)!=null&&o.pdfUrl)&&((g=s.metadata)!=null&&g.imageUrl)?(N(C({id:n,name:r.title,author:r.author,description:r.description,pdfUrl:s.metadata.pdfUrl,image:s.metadata.imageUrl,genre:r.genre||"N/A",publishDate:r.publishDate||"N/A",price:r.price||"$100"})),alert(s.message||"Book uploaded and added to favorites!"),D("/browse-books")):(console.error("Upload failed, response data:",s),alert(`Upload failed: ${(s==null?void 0:s.message)||"Unknown error from server"}`))}catch(l){console.error("Error uploading book:",l),alert("Failed to upload book. Try again later.")}};return e.jsxs(e.Fragment,{children:[e.jsx("h1",{children:"Add a New Book"}),e.jsxs("div",{className:"add-book-container",children:[e.jsxs("form",{onSubmit:k,className:"add-book-form",children:[e.jsx("input",{type:"text",name:"title",placeholder:"Title",value:r.title,onChange:t=>i({...r,title:t.target.value}),required:!0}),e.jsx("input",{type:"text",name:"author",placeholder:"Author",value:r.author,onChange:t=>i({...r,author:t.target.value}),required:!0}),e.jsx("input",{type:"text",name:"price",placeholder:"Price",value:r.price,onChange:t=>i({...r,price:t.target.value}),required:!0}),e.jsx("textarea",{name:"description",placeholder:"Description",value:r.description,onChange:t=>i({...r,description:t.target.value}),required:!0}),e.jsx("input",{type:"text",name:"publishDate",placeholder:"Publish Date",value:r.publishDate,onChange:t=>i({...r,publishDate:t.target.value}),required:!0}),e.jsx("input",{type:"text",name:"genre",placeholder:"Genre",value:r.genre,onChange:t=>i({...r,genre:t.target.value}),required:!0}),e.jsxs("div",{className:"upload-btn",children:[e.jsxs("label",{className:"file-upload",children:[e.jsx("input",{type:"file",accept:".pdf",onChange:t=>u(t,"pdf"),required:!0}),e.jsx("span",{children:p})]}),e.jsxs("label",{className:"file-upload",children:[e.jsx("input",{type:"file",accept:"image/*",onChange:t=>u(t,"image"),required:!0}),e.jsx("span",{children:c})]})]}),e.jsx("button",{type:"submit",children:"Upload & Add to Favorites"})]}),r.title&&e.jsxs("div",{className:"preview-section",children:[e.jsx("h2",{children:"Book Preview"}),e.jsxs("p",{children:[e.jsx("strong",{children:"Title:"})," ",r.title]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Author:"})," ",r.author]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Price:"})," ",r.price||"$100"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Genre:"})," ",r.genre||"N/A"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Publish Date:"})," ",r.publishDate||"N/A"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Description:"})," ",r.description]}),e.jsxs("p",{children:[e.jsx("strong",{children:"PDF:"})," ",p]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Cover Image:"})," ",c]}),h&&e.jsxs(e.Fragment,{children:[e.jsx("h3",{children:"Cover Image Preview:"}),e.jsx("img",{src:h,alt:"Book Cover",style:{width:"200px",height:"auto",borderRadius:"10px"}})]})]})]})]})};export{A as default};
