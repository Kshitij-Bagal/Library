import{r as d,a as P,b as C,j as e,c as F}from"./index-DeQE5H57.js";const A=()=>{const[t,i]=d.useState({title:"",author:"",description:"",price:"",publishDate:"",genre:"",pdf:null,image:null}),[p,x]=d.useState("No PDF chosen"),[c,j]=d.useState("No Image chosen"),[f,v]=d.useState(0),[h,b]=d.useState(null),N=P(),D=C();d.useEffect(()=>{fetch("http://localhost:8000/api/books").then(r=>r.json()).then(r=>v(r.length)).catch(r=>console.error("Error fetching book count:",r))},[]);const u=(r,a)=>{const o=r.target.files[0];if(i(n=>({...n,[a]:o})),a==="pdf"&&x(o?o.name:"No PDF chosen"),a==="image"&&(j(o?o.name:"No Image chosen"),o)){const n=new FileReader;n.onloadend=()=>b(n.result),n.readAsDataURL(o)}},k=async r=>{var n,g;if(r.preventDefault(),!t.title||!t.author||!t.description||!t.pdf||!t.image){alert("Please fill all fields and upload both the PDF and cover image.");return}const a=new FormData,o=f+1;a.append("id",o),a.append("name",t.title),a.append("price",t.price||"$100"),a.append("author",t.author),a.append("description",t.description),a.append("genre",t.genre||"N/A"),a.append("publishDate",t.publishDate||"N/A"),a.append("pdf",t.pdf),a.append("image",t.image);try{const l=await fetch("http://localhost:8000/upload",{method:"POST",body:a});if(!l.ok)throw new Error(`Upload failed: ${l.status} ${l.statusText}`);const m=await l.text();console.log("Raw server response:",m);let s;try{s=JSON.parse(m)}catch(w){console.error("Error parsing JSON:",w),alert("Invalid response from the server.");return}s!=null&&s.success&&((n=s.metadata)!=null&&n.pdfUrl)&&((g=s.metadata)!=null&&g.imageUrl)?(N(F({id:o,name:t.title,author:t.author,description:t.description,pdfUrl:s.metadata.pdfUrl,image:s.metadata.imageUrl,genre:t.genre||"N/A",publishDate:t.publishDate||"N/A",price:t.price||"$100"})),alert(s.message||"Book uploaded and added to favorites!"),D("/browse-books")):(console.error("Upload failed, response data:",s),alert(`Upload failed: ${(s==null?void 0:s.message)||"Unknown error from server"}`))}catch(l){console.error("Error uploading book:",l),alert("Failed to upload book. Try again later.")}};return e.jsxs(e.Fragment,{children:[e.jsx("h1",{children:"Add a New Book"}),e.jsxs("div",{className:"add-book-container",children:[e.jsxs("form",{onSubmit:k,className:"add-book-form",children:[e.jsx("input",{type:"text",name:"title",placeholder:"Title",value:t.title,onChange:r=>i({...t,title:r.target.value}),required:!0}),e.jsx("input",{type:"text",name:"author",placeholder:"Author",value:t.author,onChange:r=>i({...t,author:r.target.value}),required:!0}),e.jsx("input",{type:"text",name:"price",placeholder:"Price",value:t.price,onChange:r=>i({...t,price:r.target.value}),required:!0}),e.jsx("textarea",{name:"description",placeholder:"Description",value:t.description,onChange:r=>i({...t,description:r.target.value}),required:!0}),e.jsx("input",{type:"text",name:"publishDate",placeholder:"Publish Date",value:t.publishDate,onChange:r=>i({...t,publishDate:r.target.value}),required:!0}),e.jsx("input",{type:"text",name:"genre",placeholder:"Genre",value:t.genre,onChange:r=>i({...t,genre:r.target.value}),required:!0}),e.jsxs("div",{className:"upload-btn",children:[e.jsxs("label",{className:"file-upload",children:[e.jsx("input",{type:"file",accept:".pdf",onChange:r=>u(r,"pdf"),required:!0}),e.jsx("span",{children:p})]}),e.jsxs("label",{className:"file-upload",children:[e.jsx("input",{type:"file",accept:"image/*",onChange:r=>u(r,"image"),required:!0}),e.jsx("span",{children:c})]})]}),e.jsx("button",{type:"submit",children:"Upload & Add to Favorites"})]}),t.title&&e.jsxs("div",{className:"preview-section",children:[e.jsx("h2",{children:"Book Preview"}),e.jsxs("p",{children:[e.jsx("strong",{children:"Title:"})," ",t.title]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Author:"})," ",t.author]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Price:"})," ",t.price||"$100"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Genre:"})," ",t.genre||"N/A"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Publish Date:"})," ",t.publishDate||"N/A"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Description:"})," ",t.description]}),e.jsxs("p",{children:[e.jsx("strong",{children:"PDF:"})," ",p]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Cover Image:"})," ",c]}),h&&e.jsxs(e.Fragment,{children:[e.jsx("h3",{children:"Cover Image Preview:"}),e.jsx("img",{src:h,alt:"Book Cover",style:{width:"200px",height:"auto",borderRadius:"10px"}})]})]})]})]})};export{A as default};
