import{j as t,u as I,r as s,L as C}from"./index-ChPI-T4s.js";const F=({pdfUrl:r})=>{if(!r)return t.jsx("p",{className:"error-text",children:"No PDF available."});const e=S(r);return e?(console.log("Google Drive File ID:",e),t.jsx("div",{className:"book-view-container",children:t.jsx("iframe",{src:`https://drive.google.com/file/d/${e}/preview`,width:"100%",height:"600px",allow:"autoplay"})})):t.jsx("p",{className:"error-text",children:"Invalid PDF URL."})},S=r=>{const e=r.match(/(?:id=|\/d\/)([a-zA-Z0-9_-]+)/);return e?e[1]:null},A=()=>{const{name:r}=I(),[e,f]=s.useState(null),[p,j]=s.useState(""),[c,w]=s.useState(!1),[b,g]=s.useState(null),[o,u]=s.useState(0),[l,v]=s.useState(null),d="https://raw.githubusercontent.com/Kshitij-Bagal/Library-images/main/",x=`${d}link_to_image_.png`,[N,h]=s.useState(x),[R,U]=s.useState(!1);s.useEffect(()=>{const n=async()=>{try{const a=await fetch(`https://library-backend-vi4b.onrender.com/api/books/${encodeURIComponent(r)}`);if(!a.ok)throw new Error("Book not found");const i=await a.json();f(i)}catch(a){j(a.message)}};(async()=>{try{const a=await fetch(`https://library-backend-vi4b.onrender.com/api/books/${encodeURIComponent(r)}/ratings`);if(!a.ok)throw new Error("Failed to fetch ratings");const i=await a.json();g(i.avgRating),u(i.totalRatings)}catch(a){console.error("Error fetching ratings:",a)}})(),n()},[r]),s.useEffect(()=>{e&&h(`${d}${encodeURIComponent(e.name)}.jpg`)},[e]);const k=()=>{!R&&e?(h(`${d}${encodeURIComponent(e.name)}.png`),U(!0)):h(x)},y=async()=>{if(e!=null&&e.pdfUrl){try{await fetch(`https://library-backend-vi4b.onrender.com/api/books/${e.name}/increment-download`,{method:"PATCH",headers:{"Content-Type":"application/json"}}),console.log(`Download count increased for: ${e.name}`)}catch(n){console.error("Failed to update download count:",n)}window.open(e.pdfUrl,"_blank")}},E=async n=>{try{if(!(await fetch(`https://library-backend-vi4b.onrender.com/api/books/${encodeURIComponent(r)}/rate`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({rating:n})})).ok)throw new Error("Failed to submit rating");v(n),u(o+1),g(((n+parseFloat(n)*o)/(o+1)).toFixed(1))}catch(m){console.error("Error submitting rating:",m)}};return p?t.jsx("p",{className:"text-center text-red-500",children:p}):e?t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"book-details-container",children:t.jsxs("div",{className:"book-details-card",children:[t.jsx("img",{src:N,alt:(e==null?void 0:e.name)||"Book cover",className:"details-book-cover",onError:k}),t.jsxs("div",{className:"detailed-book-info",children:[t.jsx("h2",{children:(e==null?void 0:e.name)||"Unknown Title"}),t.jsxs("p",{children:[t.jsx("strong",{children:"Author:"})," ",(e==null?void 0:e.author)||"Unknown"]}),t.jsxs("p",{children:[t.jsx("strong",{children:"Genre:"})," ",(e==null?void 0:e.genre)||"N/A"]}),t.jsxs("p",{children:[t.jsx("strong",{children:"Published:"})," ",(e==null?void 0:e.publishDate)||"N/A"]}),t.jsxs("p",{children:[t.jsx("strong",{children:"Description:"})," ",(e==null?void 0:e.description)||"No description available."]}),t.jsxs("div",{className:"book-actions",children:[(e==null?void 0:e.pdfUrl)&&t.jsxs(t.Fragment,{children:[t.jsx("a",{href:e.pdfUrl,target:"_blank",rel:"noopener noreferrer",className:"download-btn",onClick:y,children:"üì• Download"}),t.jsx("button",{onClick:()=>w(!c),className:"read-online-btn",children:c?"‚ùå Close Preview":"üìñ Read Online"})]}),t.jsx(C,{to:"/Library/browse-books",className:"back-btn",children:"üîô Back to Browse"})]}),t.jsxs("div",{className:"ratings",children:[t.jsxs("p",{children:[t.jsx("strong",{children:"Average Rating:"})," ",b||"Not rated yet"," ‚≠ê (",o," reviews)"]}),l?t.jsxs("p",{children:["‚úÖ You rated this book: ",l," ‚≠ê"]}):t.jsx("div",{className:"rating-buttons",children:[5,4,3,2,1].map(n=>t.jsx("button",{onClick:()=>E(n),className:`star-btn ${l>=n?"selected":""}`,children:"‚≠ê"},n))})]})]})]})}),c&&(e==null?void 0:e.pdfUrl)&&t.jsx(F,{pdfUrl:e.pdfUrl})]}):t.jsx("p",{className:"text-center text-blue-500",children:"Loading book..."})};export{A as default};
