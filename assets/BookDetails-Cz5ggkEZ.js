import{j as t,u as I,r as n,L as C}from"./index-DeQE5H57.js";const F=({pdfUrl:r})=>{if(!r)return t.jsx("p",{className:"error-text",children:"No PDF available."});const e=S(r);return e?(console.log("Google Drive File ID:",e),t.jsx("div",{className:"book-view-container",children:t.jsx("iframe",{src:`https://drive.google.com/file/d/${e}/preview`,width:"100%",height:"600px",allow:"autoplay"})})):t.jsx("p",{className:"error-text",children:"Invalid PDF URL."})},S=r=>{const e=r.match(/(?:id=|\/d\/)([a-zA-Z0-9_-]+)/);return e?e[1]:null},A=()=>{const{name:r}=I(),[e,f]=n.useState(null),[m,j]=n.useState(""),[c,w]=n.useState(!1),[N,g]=n.useState(null),[o,u]=n.useState(0),[l,R]=n.useState(null),d="https://raw.githubusercontent.com/Kshitij-Bagal/Library-images/main/",x=`${d}link_to_image_.png`,[U,h]=n.useState(x),[v,b]=n.useState(!1);n.useEffect(()=>{const s=async()=>{try{const a=await fetch(`http://localhost:8000/api/books/${encodeURIComponent(r)}`);if(!a.ok)throw new Error("Book not found");const i=await a.json();f(i)}catch(a){j(a.message)}};(async()=>{try{const a=await fetch(`http://localhost:8000/api/books/${encodeURIComponent(r)}/ratings`);if(!a.ok)throw new Error("Failed to fetch ratings");const i=await a.json();g(i.avgRating),u(i.totalRatings)}catch(a){console.error("Error fetching ratings:",a)}})(),s()},[r]),n.useEffect(()=>{e&&h(`${d}${encodeURIComponent(e.name)}.jpg`)},[e]);const k=()=>{!v&&e?(h(`${d}${encodeURIComponent(e.name)}.png`),b(!0)):h(x)},y=async()=>{if(e!=null&&e.pdfUrl){try{await fetch(`http://localhost:8000/api/books/${e.name}/increment-download`,{method:"PATCH",headers:{"Content-Type":"application/json"}}),console.log(`Download count increased for: ${e.name}`)}catch(s){console.error("Failed to update download count:",s)}window.open(e.pdfUrl,"_blank")}},E=async s=>{try{if(!(await fetch(`http://localhost:8000/api/books/${encodeURIComponent(r)}/rate`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({rating:s})})).ok)throw new Error("Failed to submit rating");R(s),u(o+1),g(((s+parseFloat(s)*o)/(o+1)).toFixed(1))}catch(p){console.error("Error submitting rating:",p)}};return m?t.jsx("p",{className:"text-center text-red-500",children:m}):e?t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"book-details-container",children:t.jsxs("div",{className:"book-details-card",children:[t.jsx("img",{src:U,alt:(e==null?void 0:e.name)||"Book cover",className:"details-book-cover",onError:k}),t.jsxs("div",{className:"detailed-book-info",children:[t.jsx("h2",{children:(e==null?void 0:e.name)||"Unknown Title"}),t.jsxs("p",{children:[t.jsx("strong",{children:"Author:"})," ",(e==null?void 0:e.author)||"Unknown"]}),t.jsxs("p",{children:[t.jsx("strong",{children:"Genre:"})," ",(e==null?void 0:e.genre)||"N/A"]}),t.jsxs("p",{children:[t.jsx("strong",{children:"Published:"})," ",(e==null?void 0:e.publishDate)||"N/A"]}),t.jsxs("p",{children:[t.jsx("strong",{children:"Description:"})," ",(e==null?void 0:e.description)||"No description available."]}),t.jsxs("div",{className:"book-actions",children:[(e==null?void 0:e.pdfUrl)&&t.jsxs(t.Fragment,{children:[t.jsx("a",{href:e.pdfUrl,target:"_blank",rel:"noopener noreferrer",className:"download-btn",onClick:y,children:"üì• Download"}),t.jsx("button",{onClick:()=>w(!c),className:"read-online-btn",children:c?"‚ùå Close Preview":"üìñ Read Online"})]}),t.jsx(C,{to:"/Library/browse-books",className:"back-btn",children:"üîô Back to Browse"})]}),t.jsxs("div",{className:"ratings",children:[t.jsxs("p",{children:[t.jsx("strong",{children:"Average Rating:"})," ",N||"Not rated yet"," ‚≠ê (",o," reviews)"]}),l?t.jsxs("p",{children:["‚úÖ You rated this book: ",l," ‚≠ê"]}):t.jsx("div",{className:"rating-buttons",children:[5,4,3,2,1].map(s=>t.jsx("button",{onClick:()=>E(s),className:`star-btn ${l>=s?"selected":""}`,children:"‚≠ê"},s))})]})]})]})}),c&&(e==null?void 0:e.pdfUrl)&&t.jsx(F,{pdfUrl:e.pdfUrl})]}):t.jsx("p",{className:"text-center text-blue-500",children:"Loading book..."})};export{A as default};
